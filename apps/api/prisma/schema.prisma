generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  passwordHash  String    @map("password_hash")
  firstName     String    @map("first_name")
  lastName      String    @map("last_name")
  role          String    @default("BUYER") // BUYER, SELLER, ADMIN
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  products      Product[]
  orders        Order[]
  reviews       Review[]

  @@map("users")
}

model Product {
  id            String    @id @default(uuid())
  sellerId      String    @map("seller_id")
  title         String
  description   String
  price         Float
  category      String
  condition     String    // NEW, USED
  stockQuantity Int       @map("stock_quantity")
  images        Image[]
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  seller        User      @relation(fields: [sellerId], references: [id])
  orderItems    OrderItem[]
  reviews       Review[]

  @@map("products")
}

model Image {
  id        String   @id @default(uuid())
  url       String
  productId String   @map("product_id")
  product   Product  @relation(fields: [productId], references: [id])

  @@map("images")
}

model Order {
  id            String      @id @default(uuid())
  buyerId       String      @map("buyer_id")
  totalAmount   Float       @map("total_amount")
  status        String      @default("PENDING") // PENDING, PAID, SHIPPED, DELIVERED, CANCELLED
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")

  buyer         User        @relation(fields: [buyerId], references: [id])
  orderItems    OrderItem[]

  @@map("orders")
}

model OrderItem {
  id              String  @id @default(uuid())
  orderId         String  @map("order_id")
  productId       String  @map("product_id")
  quantity        Int
  priceAtPurchase Float   @map("price_at_purchase")

  order           Order   @relation(fields: [orderId], references: [id])
  product         Product @relation(fields: [productId], references: [id])

  @@map("order_items")
}

model Review {
  id        String   @id @default(uuid())
  productId String   @map("product_id")
  userId    String   @map("user_id")
  rating    Int
  comment   String?
  createdAt DateTime @default(now()) @map("created_at")

  product   Product  @relation(fields: [productId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@map("reviews")
}
